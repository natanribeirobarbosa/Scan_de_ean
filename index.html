<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
</head>
<body>

<video id="preview" autoplay playsinline width="400" height="300" style="border:1px solid #ccc;"></video>
<ul id="qrList"></ul>

<script>
const qrList = document.getElementById('qrList');
const video = document.getElementById('preview');

function saveToCookie(data) {
  let stored = getStoredQRCodes();
  if (!stored.includes(data)) {
    stored.push(data);
    document.cookie = `qrcodes=${JSON.stringify(stored)};path=/`;
    updateList();
  }
}

function getStoredQRCodes() {
  let match = document.cookie.match(/(?:^|; )qrcodes=([^;]*)/);
  return match ? JSON.parse(decodeURIComponent(match[1])) : [];
}

function updateList() {
  qrList.innerHTML = '';
  getStoredQRCodes().forEach(code => {
    let li = document.createElement('li');
    li.textContent = code;
    qrList.appendChild(li);
  });
}

function startBarcodeScanner() {
  Quagga.init({
    inputStream: {
      name: "Live",
      type: "LiveStream",
      target: video,
      constraints: {
        facingMode: "environment"
      },
    },
    decoder: {
      readers: [
        "code_128_reader",
        "ean_reader",
        "ean_8_reader",
        "code_39_reader",
        "upc_reader",
        "upc_e_reader"
      ]
    },
  }, function(err) {
    if (err) {
      console.error('Erro ao iniciar Quagga:', err);
      return;
    }
    Quagga.start();
  });

  Quagga.onDetected((result) => {
    const code = result.codeResult.code;
    if (code) {
      saveToCookie(code);
      Quagga.stop(); // remove se quiser leitura contÃ­nua
    }
  });
}

window.onload = () => {
  startBarcodeScanner();
  updateList();
};
</script>

</body>
</html>
